<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Or√ßamentos - Tag Som e Luz</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
     <link rel="stylesheet" href="assets/style.css">
</head>
<body>
    
   <div class="app-container">
        <button class="mobile-menu-toggle" id="mobileMenuToggle" style="display: none;">
            <i class="fas fa-bars"></i>
        </button>
        
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="sidebar-header">
                <div class="sidebar-logo">
                    <div class="sidebar-logo-icon">
                        <i class="fas fa-lightbulb"></i>
                    </div>
                    <h1>Tag</h1>
                </div>
            </div>
            
            <ul class="nav-menu">
                <li class="nav-item">
                    <a href="dashboard.html" class="nav-link">
                        <i class="fas fa-home"></i>
                        <span>Dashboard</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="equipamentos.html" class="nav-link">
                        <i class="fas fa-boxes"></i>
                        <span>Equipamentos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="orcamentos.html" class="nav-link active">
                        <i class="fas fa-file-invoice-dollar"></i>
                        <span>Or√ßamentos</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="checklists.html" class="nav-link">
                        <i class="fas fa-clipboard-check"></i>
                        <span>Checklists</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="eventos.html" class="nav-link">
                        <i class="fas fa-calendar-alt"></i>
                        <span>Eventos Agendados</span>
                    </a>
                </li>
                <li class="nav-item">
                    <a href="agendamento.html" class="nav-link">
                        <i class="fas fa-calendar-check"></i>
                        <span>Agendamento</span>
                    </a>
                </li>
            </ul>
        </div>
        
        <div class="main-content">
            <div class="topbar">
                <div class="page-title" style="font-size: 1.6rem; font-weight: 600; color: #FF6B00;">Or√ßamentos</div>
                <div class="user-info">
                    <div class="user-avatar" style="background: #FF6B00; color: white; padding: 10px; border-radius: 50%; display: inline-block;">TAG</div>
                </div>
            </div>
            
            <!-- Conte√∫do Or√ßamentos -->
            <div class="container-orcamentos">
                <div class="header-orcamentos">
                    <button id="btn-novo-orcamento" class="btn-primary">
                        <i class="fas fa-plus"></i> Novo Or√ßamento
                    </button>
                    
                    <div class="controles-orcamento">
                        <span class="total-orcamentos" style="color: #dbdbdb;">
                            <i class="fas fa-file-invoice"></i> Total: <strong id="contador-orcamentos">0</strong> or√ßamentos
                        </span>
                    </div>
                </div>

                





<div id="modal-orcamento" class="modal" style="display: none;">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h3 id="modal-orcamento-title"><i class="fas fa-file-invoice-dollar"></i> Novo Or√ßamento</h3>
                            <button class="btn-fechar" id="btn-fechar-modal-orcamento">√ó</button>
                        </div>
                        
                        <form id="form-orcamento">
                            <input type="hidden" id="orcamento-id">
                            
                            <div class="form-grid">
                                <div class="input-group">
                                    <label><i class="fas fa-user"></i> Cliente</label>
                                    <input type="text" id="orcamento-cliente" required>
                                </div>
                                
                                <div class="input-group">
                                    <label><i class="fas fa-calendar-alt"></i> Tipo de Evento</label>
                                    <select id="orcamento-evento" required>
                                        <option value="">Selecione...</option>
                                        <option value="casamento">Casamento</option>
                                        <option value="aniversario">Anivers√°rio</option>
                                        <option value="corporativo">Evento Corporativo</option>
                                        <option value="formatura">Formatura</option>
                                        <option value="outro">Outro</option>
                                    </select>
                                </div>
                                
                                <div class="input-group">
                                    <label><i class="fas fa-calendar-day"></i> Data do Evento</label>
                                    <input type="date" id="orcamento-data" required>
                                </div>
                                
                                <div class="input-group">
                                    <label><i class="fas fa-map-marker-alt"></i> Local</label>
                                    <input type="text" id="orcamento-local" required>
                                </div>
                            </div>
                            
                            <div class="input-group">
                                <label><i class="fas fa-sticky-note"></i> Observa√ß√µes</label>
                                <textarea id="orcamento-observacoes" rows="3" placeholder="Observa√ß√µes adicionais..."></textarea>
                            </div>

                            <div class="secao-equipamentos">
                                <h4><i class="fas fa-boxes"></i> Equipamentos do Or√ßamento</h4>
                                <div id="lista-equipamentos-orcamento" class="lista-equipamentos">
                                    <!-- Equipamentos ser√£o carregados aqui -->
                                </div>
                                
                                <div class="total-orcamento">
                                    <strong>Total: R$ <span id="total-orcamento-form">0.00</span></strong>
                                </div>
                            </div>

                            <div class="form-actions">
                                <button type="submit" class="btn-submit">
                                    <i class="fas fa-save"></i> Salvar Or√ßamento
                                </button>
                                <button type="button" class="btn-cancelar" id="btn-cancelar-orcamento">
                                    <i class="fas fa-times"></i> Cancelar
                                </button>
                            </div>
                        </form>
                    
                    </div>
                </div>

                <div class="lista-orcamentos-container">
                    <div class="filtros-orcamentos" style="display: flex; gap: 10px; margin-bottom: 20px;">
                        <select id="filtro-status" style="padding: 8px; background: rgba(30,30,30,0.8); border: 1px solid #444; border-radius: 6px; color: white;">
                            <option value="">Todos os status</option>
                            <option value="pendente">Pendentes</option>
                            <option value="aprovado">Aprovados</option>
                            <option value="recusado">Recusados</option>
                        </select>
                        
                        <input type="text" id="busca-orcamento" placeholder="Buscar cliente..." style="flex: 1; padding: 8px; background: rgba(30,30,30,0.8); border: 1px solid #444; border-radius: 6px; color: white;">
                    </div>

                    <div id="lista-orcamentos" class="lista-orcamentos">
                        <!-- Or√ßamentos ser√£o carregados aqui -->
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- JavaScript Integrado -->
    <script>
        // =============================================
        // DADOS E INICIALIZA√á√ÉO
        // =============================================
        
        console.log('üöÄ Iniciando sistema de or√ßamentos...');
        
        let orcamentos = JSON.parse(localStorage.getItem('orcamentos')) || [];
        let equipamentos = JSON.parse(localStorage.getItem('equipamentos')) || [];

        // =============================================
        // FUN√á√ïES PRINCIPAIS
        // =============================================

        function criarDadosExemplo() {
            console.log('üîß Verificando dados...');
            
            if (orcamentos.length === -1) {
                console.log('üí∞ Criando or√ßamentos de exemplo...');
                orcamentos = [
                    {
                        id: 1,
                        cliente: "Maria Silva",
                        tipoEvento: "casamento",
                        data: "2024-12-15",
                        local: "Sal√£o de Festas Jardim",
                        observacoes: "Casamento com 200 convidados",
                        equipamentos: [],
                        total: 1260,
                        status: "pendente",
                        dataCriacao: new Date().toISOString()
                    },
                    {
                        id: 2,
                        cliente: "Empresa XYZ",
                        tipoEvento: "corporativo",
                        data: "2024-12-20",
                        local: "Centro de Conven√ß√µes",
                        observacoes: "Evento corporativo anual",
                        equipamentos: [],
                        total: 800,
                        status: "aprovado",
                        dataCriacao: new Date().toISOString()
                    },
                    {
                        id: 3,
                        cliente: "Jo√£o Santos",
                        tipoEvento: "aniversario",
                        data: "2024-12-25",
                        local: "Casa de Festas",
                        observacoes: "Anivers√°rio de 15 anos",
                        equipamentos: [],
                        total: 740,
                        status: "recusado",
                        dataCriacao: new Date().toISOString()
                    }
                ];
                localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
                console.log('‚úÖ Or√ßamentos de exemplo criados!');
            }
            
            return orcamentos;
        }

        function carregarOrcamentos() {
            console.log('üîÑ Carregando or√ßamentos...');
            
            const container = document.getElementById('lista-orcamentos');
            if (!container) {
                console.error('‚ùå ERRO: Elemento #lista-orcamentos n√£o encontrado!');
                return;
            }
            
            // For√ßar cria√ß√£o de dados de exemplo
            orcamentos = criarDadosExemplo();
            
            console.log('üìã Or√ßamentos para exibir:', orcamentos);
            
            // Limpar container
            container.innerHTML = '';
            
            if (orcamentos.length === 0) {
                container.innerHTML = `
                    <div style="text-align: center; padding: 60px 20px; color: #8e8e8e;">
                        <i class="fas fa-file-invoice-dollar fa-3x" style="margin-bottom: 20px; color: #AE2D68;"></i>
                        <h3 style="margin-bottom: 10px; color: #dbdbdb;">Nenhum or√ßamento encontrado</h3>
                        <p>Clique em "Novo Or√ßamento" para criar o primeiro</p>
                    </div>
                `;
                console.log('‚ÑπÔ∏è Nenhum or√ßamento para exibir');
            } else {
                // Ordenar or√ßamentos por data (mais recentes primeiro)
                const orcamentosOrdenados = [...orcamentos].sort((a, b) => new Date(b.dataCriacao) - new Date(a.dataCriacao));
                
                orcamentosOrdenados.forEach(orcamento => {
                    const orcamentoElement = criarElementoOrcamento(orcamento);
                    container.appendChild(orcamentoElement);
                });
                
                console.log('‚úÖ Or√ßamentos carregados:', orcamentos.length);
            }
            
            // Atualizar contador
            atualizarContadorOrcamentos();
        }

        function criarElementoOrcamento(orcamento) {
            const div = document.createElement('div');
            div.className = 'orcamento-item';
            div.setAttribute('data-id', orcamento.id);
            
            div.innerHTML = `
                <div class="orcamento-header">
                    <div class="orcamento-info">
                        <h4 class="orcamento-cliente">
                            <i class="fas fa-user"></i> ${orcamento.cliente}
                        </h4>
                        <div class="orcamento-detalhes">
                            <span class="detalhe-item">
                                <i class="fas fa-calendar-day"></i> ${formatarData(orcamento.data)}
                            </span>
                            <span class="detalhe-item">
                                <i class="fas fa-map-marker-alt"></i> ${orcamento.local}
                            </span>
                            <span class="detalhe-item">
                                <i class="fas fa-tag"></i> ${formatarTipoEvento(orcamento.tipoEvento)}
                            </span>
                        </div>
                        ${orcamento.observacoes ? `
                        <div style="color: #dbdbdb; font-size: 0.9rem; background: rgba(255,255,255,0.05); padding: 8px 12px; border-radius: 6px; margin-top: 8px;">
                            <i class="fas fa-sticky-note"></i> ${orcamento.observacoes}
                        </div>
                        ` : ''}
                    </div>
                    <div class="orcamento-meta">
                        <div class="status-badge status-${orcamento.status}">
                            ${orcamento.status.toUpperCase()}
                        </div>
                        <div class="orcamento-total">
                            R$ ${orcamento.total.toFixed(2)}
                        </div>
                    </div>
                </div>
                
                <div class="orcamento-acoes">
                    ${orcamento.status === 'pendente' ? `
                    <button class="btn-acao btn-aprovar" onclick="aprovarOrcamento(${orcamento.id})">
                        <i class="fas fa-check"></i> Aprovar
                    </button>
                    <button class="btn-acao btn-rejeitar" onclick="rejeitarOrcamento(${orcamento.id})">
                        <i class="fas fa-times"></i> Rejeitar
                    </button>
                    ` : ''}
                    
                    <button class="btn-acao btn-editar" onclick="editarOrcamento(${orcamento.id})">
                        <i class="fas fa-edit"></i> Editar
                    </button>
                    <button class="btn-acao btn-excluir" onclick="excluirOrcamento(${orcamento.id})">
                        <i class="fas fa-trash"></i> Excluir
                    </button>
                    
                    <button class="btn-acao btn-detalhes" onclick="verDetalhesOrcamento(${orcamento.id})">
                        <i class="fas fa-eye"></i> Detalhes
                    </button>
                </div>
            `;
            
            return div;
        }

        function atualizarContadorOrcamentos() {
            const contador = document.getElementById('contador-orcamentos');
            if (contador) {
                contador.textContent = orcamentos.length;
                console.log('üî¢ Contador atualizado:', orcamentos.length);
            }
        }

        // =============================================
        // FUN√á√ïES DO CRUD
        // =============================================

        // =============================================
// FUN√á√ÉO EDITAR OR√áAMENTO - CORRIGIDA
// =============================================

function editarOrcamento(id) {
    console.log('‚úèÔ∏è Editando or√ßamento:', id);
    
    const orcamento = orcamentos.find(o => o.id == id);
    if (orcamento) {
        // Preencher o modal com os dados do or√ßamento
        document.getElementById('modal-orcamento-title').innerHTML = '<i class="fas fa-edit"></i> Editar Or√ßamento';
        document.getElementById('orcamento-id').value = orcamento.id;
        document.getElementById('orcamento-cliente').value = orcamento.cliente;
        document.getElementById('orcamento-evento').value = orcamento.tipoEvento;
        document.getElementById('orcamento-data').value = orcamento.data;
        document.getElementById('orcamento-local').value = orcamento.local;
        document.getElementById('orcamento-observacoes').value = orcamento.observacoes || '';
        
        // Abrir o modal
        document.getElementById('modal-orcamento').style.display = 'flex';
        
        console.log('‚úÖ Modal de edi√ß√£o aberto para:', orcamento.cliente);
    } else {
        alert('Or√ßamento n√£o encontrado!');
        console.error('‚ùå Or√ßamento n√£o encontrado:', id);
    }
}

        function excluirOrcamento(id) {
            console.log('üóëÔ∏è Excluindo or√ßamento:', id);
            if (confirm('Tem certeza que deseja excluir este or√ßamento?')) {
                const index = orcamentos.findIndex(o => o.id == id);
                if (index !== -1) {
                    orcamentos.splice(index, 1);
                    localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
                    carregarOrcamentos();
                    alert('Or√ßamento exclu√≠do com sucesso!');
                }
            }
        }

        function aprovarOrcamento(id) {
            console.log('‚úÖ Aprovando or√ßamento:', id);
            const orcamento = orcamentos.find(o => o.id === id);
            if (!orcamento) return;
            
            orcamento.status = 'aprovado';
            localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
            carregarOrcamentos();
            alert('Or√ßamento aprovado com sucesso!');
        }

        function rejeitarOrcamento(id) {
            console.log('‚ùå Rejeitando or√ßamento:', id);
            const orcamento = orcamentos.find(o => o.id === id);
            if (!orcamento) return;
            
            orcamento.status = 'recusado';
            localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
            carregarOrcamentos();
            alert('Or√ßamento recusado!');
        }

        function verDetalhesOrcamento(id) {
            console.log('üëÄ Ver detalhes do or√ßamento:', id);
            const orcamento = orcamentos.find(o => o.id === id);
            if (!orcamento) return;
            
            let detalhes = `CLIENTE: ${orcamento.cliente}\n`;
            detalhes += `EVENTO: ${formatarTipoEvento(orcamento.tipoEvento)}\n`;
            detalhes += `DATA: ${formatarData(orcamento.data)}\n`;
            detalhes += `LOCAL: ${orcamento.local}\n`;
            detalhes += `STATUS: ${orcamento.status.toUpperCase()}\n`;
            detalhes += `TOTAL: R$ ${orcamento.total.toFixed(2)}\n`;
            
            if (orcamento.observacoes) {
                detalhes += `\nOBSERVA√á√ïES: ${orcamento.observacoes}`;
            }
            
            alert(detalhes);
        }

        // =============================================
        // FUN√á√ïES AUXILIARES
        // =============================================

        function formatarTipoEvento(tipo) {
            const tipos = {
                'casamento': 'Casamento',
                'aniversario': 'Anivers√°rio',
                'corporativo': 'Evento Corporativo',
                'formatura': 'Formatura',
                'outro': 'Outro'
            };
            return tipos[tipo] || tipo;
        }

        function formatarData(dataString) {
            if (!dataString) return 'Data n√£o informada';
            try {
                const data = new Date(dataString);
                return data.toLocaleDateString('pt-BR');
            } catch (error) {
                return 'Data inv√°lida';
            }
        }

        // =============================================
        // INICIALIZA√á√ÉO DO SISTEMA
        // =============================================

        function inicializarSistemaOrcamentos() {
            console.log('üí∞ Inicializando sistema de or√ßamentos...');
            
            // Bot√£o novo or√ßamento
            const btnNovo = document.getElementById('btn-novo-orcamento');
            if (btnNovo) {
                btnNovo.addEventListener('click', () => {
                    console.log('‚ûï Abrindo modal de novo or√ßamento');
                    document.getElementById('modal-orcamento').style.display = 'flex';
                });
            }
            
            // Fechar modal
            const btnFechar = document.getElementById('btn-fechar-modal-orcamento');
            if (btnFechar) {
                btnFechar.addEventListener('click', () => {
                    document.getElementById('modal-orcamento').style.display = 'none';
                });
            }
            
            const btnCancelar = document.getElementById('btn-cancelar-orcamento');
            if (btnCancelar) {
                btnCancelar.addEventListener('click', () => {
                    document.getElementById('modal-orcamento').style.display = 'none';
                });
            }
            
           // =============================================
// FUN√á√ÉO SALVAR OR√áAMENTO - CORRIGIDA PARA EDITAR TAMB√âM
// =============================================

// Formul√°rio de or√ßamento
const formOrcamento = document.getElementById('form-orcamento');
if (formOrcamento) {
    formOrcamento.addEventListener('submit', function(e) {
        e.preventDefault();
        
        const id = document.getElementById('orcamento-id').value;
        const cliente = document.getElementById('orcamento-cliente').value;
        const tipoEvento = document.getElementById('orcamento-evento').value;
        const data = document.getElementById('orcamento-data').value;
        const local = document.getElementById('orcamento-local').value;
        const observacoes = document.getElementById('orcamento-observacoes').value;
        
        if (!cliente || !tipoEvento || !data || !local) {
            alert('Preencha todos os campos obrigat√≥rios!');
            return;
        }
        
        if (id) {
            // MODO EDI√á√ÉO - Atualizar or√ßamento existente
            const index = orcamentos.findIndex(o => o.id == id);
            if (index !== -1) {
                orcamentos[index] = {
                    ...orcamentos[index],
                    cliente,
                    tipoEvento,
                    data,
                    local,
                    observacoes,
                    dataAtualizacao: new Date().toISOString()
                };
                
                localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
                alert('Or√ßamento atualizado com sucesso!');
                console.log('‚úÖ Or√ßamento atualizado:', id);
            }
        } else {
            // MODO CRIA√á√ÉO - Novo or√ßamento
            const novoOrcamento = {
                id: Date.now(),
                cliente,
                tipoEvento,
                data,
                local,
                observacoes,
                equipamentos: [],
                total: Math.random() * 1000 + 500,
                status: 'pendente',
                dataCriacao: new Date().toISOString()
            };
            
            orcamentos.push(novoOrcamento);
            localStorage.setItem('orcamentos', JSON.stringify(orcamentos));
            alert('Or√ßamento criado com sucesso!');
            console.log('‚úÖ Novo or√ßamento criado:', novoOrcamento.id);
        }
        
        // Fechar modal e recarregar lista
        document.getElementById('modal-orcamento').style.display = 'none';
        formOrcamento.reset();
        carregarOrcamentos();
    });
}
            
            // Filtros
            const filtroStatus = document.getElementById('filtro-status');
            const buscaOrcamento = document.getElementById('busca-orcamento');
            
            if (filtroStatus) {
                filtroStatus.addEventListener('change', function() {
                    console.log('üîç Filtrando por status:', this.value);
                    // Implementar filtro aqui
                });
            }
            
            if (buscaOrcamento) {
                buscaOrcamento.addEventListener('input', function() {
                    console.log('üîç Buscando:', this.value);
                    // Implementar busca aqui
                });
            }
            
            console.log('‚úÖ Sistema de or√ßamentos inicializado');
        }

        // =============================================
        // INICIALIZAR TUDO QUANDO A P√ÅGINA CARREGAR
        // =============================================

        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ P√°gina carregada - Iniciando sistema...');
            
            // Carregar or√ßamentos
            carregarOrcamentos();
            
            // Inicializar sistema
            inicializarSistemaOrcamentos();
            
            console.log('üéâ Sistema totalmente carregado!');
            
            // Mostrar mensagem de sucesso
            setTimeout(() => {
                console.log('‚úÖ CRUD deve estar funcionando agora!');
                console.log('üìä Or√ßamentos no sistema:', orcamentos.length);
            }, 1000);
        });

        // =============================================
        // FUN√á√ïES GLOBAIS PARA O HTML
        // =============================================

        window.editarOrcamento = editarOrcamento;
        window.excluirOrcamento = excluirOrcamento;
        window.aprovarOrcamento = aprovarOrcamento;
        window.rejeitarOrcamento = rejeitarOrcamento;
        window.verDetalhesOrcamento = verDetalhesOrcamento;
    </script>
</body>
</html>

    <!-- Loading -->
    <div class="loading-overlay" id="loadingOverlay" style="display: none;">
        <div class="loading-spinner"></div>
    </div>

    <!-- Toast -->
    <div class="toast-container" id="toastContainer"></div>

    <script src="assets/script.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            carregarOrcamentos();
            inicializarSistemaOrcamentos();
        });
    </script>
</body>
</html>
               

